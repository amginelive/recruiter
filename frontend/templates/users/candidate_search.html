{% extends 'users/index.html' %}

{% load staticfiles i18n %}

{% block content %}
<section id="internal-wrap">
    <!-- internal block -->
        <div class="container">
            <div class="row" style="padding-top:40px;">
                <div class="col-md-12 text-center">
                    <div class="row">
                        <div class="col-md-12">
                            <form class="search-form" action="{% url 'users:candidate_search' %}" method="GET">
                                <div class="search_block">
                                    <input type="text" placeholder="Search..." name="search" value="{{ search|default_if_none:'' }}"/>
                                    <button class="btn search-btn" type="submit" value="Search"><i class="glyphicon glyphicon-search"></i> Search</button>
                                </div>
                            </form>
                        </div>
                        <div class="col-md-12 search_candidates">
                            {% for candidate in candidates %}
                                <div class="search_job_post col-md-4">
                                    <div class="col-md-4">
                                        <img src="{% if candidate.photo %}{{ candidate.photo.url }}{% else %}{% static 'img/default_user.jpg' %}{% endif %}" style="width:70px; border-radius:50%">
                                    </div>
                                    <div class="col-md-8 text-left">
                                        <span class="search-info">{{ candidate.user.get_full_name }}</span>
                                        <form action="{% url 'recruit:connection_request_create' %}" method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="request_recipient" value="{{ candidate.pk }}">
                                            <input type="hidden" name="connection_type" value="{{ connection_request.CONNECTION_TEAM_MEMBER }}">

                                            {% if candidate.pk in team_member_requests %}
                                                <button class="btn btn-primary btn-xs add-connection" disabled="disabled">Pending Team Member</button>
                                            {% else %}
                                                <button class="btn btn-primary btn-xs add-connection">Add as team member</button>
                                            {% endif %}
                                        </form>

                                        <form action="{% url 'recruit:connection_request_create' %}" method="POST">
                                            {% csrf_token %}
                                            <input type="hidden" name="request_recipient" value="{{ candidate.pk }}">
                                            <input type="hidden" name="connection_type" value="{{ connection_request.CONNECTION_NETWORK }}">
                                            {% if candidate.pk in network_requests %}
                                                <button class="btn btn-primary btn-xs add-connection" disabled="disabled">Pending Network</button>
                                            {% else %}
                                                <button class="btn btn-primary btn-xs add-connection">Add to my network</button>
                                            {% endif %}
                                        </form>
                                    </div>
                                </div>
                            {% empty %}
                                <p>No results matching your criteria found.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    <!-- end internal block -->
</section>
<!-- end new admin content -->
{% endblock %}

{% block footer_js %}
<script src="{% static 'js/jquery.form.min.js' %}"></script>
<script type="text/javascript">
    $('.add-connection').on("click", function(event) {
        event.preventDefault()
        var candidateId = $(this).attr('data-candidate-id');
        var form = $(this).closest('form');
        var connection_type = form.find('input[name=connection_type]').val();

        $.ajax({
            context: this,
            type: 'POST',
            url: form.attr('action'),
            data: form.serialize(),
            dataType: "json",
            success: function(response) {
                if (connection_type == 1)
                    $(this).html('Pending Network');
                else if (connection_type == 2)
                    $(this).html('Pending Team Member');
                $(this).attr('disabled', '');
            }
        });
    });
</script>
{% endblock footer_js %}
