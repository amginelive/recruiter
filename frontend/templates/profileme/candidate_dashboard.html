{% extends 'profileme/index.html' %}

{% load staticfiles i18n %}

{% block content %}
<section id="internal-wrap">
    <!-- internal block -->
    <section id="account">
        <div class="container">
            <div class="row">
                <div class="col-md-7 col-md-offset-1 profile-left">
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <h4>{{ request.user.get_full_name }}</h4>
                        </div>
                        <div class="col-md-8 account-actions">
                            <a class="btn" href="{% url 'dashboard_update_profile' %}"><i class="glyphicon glyphicon-edit"></i> Edit profile</a>
                            <a class="btn" href="{% url 'account_change_password' %}"><i class="glyphicon glyphicon-lock"></i> Change password</a>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-4 text-center">
                            <h5>Photo</h5>
                            <img id="profile_photo" src="{% if profile.photo %}{{ profile.photo.url }}{% else %}{% static 'img/default_user.jpg' %}{% endif %}">
                            <form action="{% url 'dashboard_photo_upload' %}" id="photo_upload_form" method="post" role="form" enctype="multipart/form-data">
                                {% csrf_token %}
                                <input type="file" name="photo" id="photo_upload" style="display:none"/>
                                <button type="button" class="btn" id="photo_upload_btn" OnClick="javascript:void(0)">{% trans "Update Photo" %}</button>
                            </form>
                        </div>
                        <div class="col-md-8">
                            <h5>My profile</h5>
                            <ul class="candidate_profile_data">
                            {{ f.country.get_value_display }}
                            {% for field in f %}
                                {% if field.value %}
                                <li>
                                  <b>{{ field.label_tag }}</b>
                                  {% if field.name == 'job_type' %}
                                    {{ profile.get_job_type_display }}
                                  {% elif field.name == 'residence_country' %}
                                    {{ profile.get_residence_country_display }}
                                  {% else %}
                                    {{ field.value }}
                                  {% endif %}
                                </li>
                                {% endif %}
                            {% endfor %}
                            </ul>
                            <a href="{% url 'recruit:search' %}" class="btn action-btn" style="width:80%; margin-top:20px;"><i class="glyphicon glyphicon-search"></i>Find job positions</a>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 profile-right">
                    <h4>Profile progress</h4>
                    <div class="progress">
                        <div aria-valuemax="100" aria-valuemin="0" aria-valuenow="0" class="progress-bar" role="progressbar" style="width: {{ profile_completeness }}%;" title="{{ profile_completeness }}%">
                            {{ profile_completeness }}%
                        </div>
                    </div>
                    <ul class="profile-steps">
                      <li><i class="glyphicon glyphicon-check"></i> Registration completed</li>
                      <li><i class="glyphicon glyphicon-{% if profile.photo %}check{% else %}remove-sign{% endif %}"></i> Photo uploaded</li>
                      <li><i class="glyphicon glyphicon-{% if is_complete %}check{% else %}remove-sign{% endif %}"></i> Complete profile</li>
                      <li><i class="glyphicon glyphicon-{% if profile.cv %}check{% else %}remove-sign{% endif %}"></i> CV uploaded</li>
                    </ul>
                    <form action="{% url 'dashboard_cv_upload' %}" id="cv_upload_form" method="post" role="form" enctype="multipart/form-data">
                        {% csrf_token %}
                        <input type="file" name="cv" id="cv_upload" style="display:none"/>
                        <button type="button" class="btn" id="cv_upload_btn" OnClick="javascript:void(0)">{% trans "Update CV" %}</button>
                        <div id="cv_updated" class="label label-success cv_updated">{% trans 'CV updated' %}</div>
                        <a href="{% if profile.cv %}{{ profile.cv.url }}{% endif %}" id="current_cv" {% if not profile.cv %}class="hidden"{% endif %}><i class="glyphicon glyphicon-download"></i> Download current CV</a>
                    </form>
                </div>
                <!-- lists / placeholders -->
                <div class="col-md-7 col-md-offset-1 bottom-blocks-left">
                    <div class="row">
                        <div class="col-md-12 my-applications">
                            <h4>My applications</h4>
                            <div class="inner">
                                You haven't applied for any jobs
                            </div>
                        </div>
                        <div class="col-md-12 job-alerts">
                            <h4>Job Alerts</h4>
                            <div class="inner">
                                Job alerts
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 suggested-jobs">
                    <h4>Suggested Jobs</h4>
                    <div class="inner">
                        Start by setting up a job alert
                    </div>
                </div>
                <!-- end lists -->
            </div>
        </div>
    </section>
    <!-- end internal block -->
</section>
<!-- end new admin content -->
{% endblock %}

{% block footer_js %}
<script src="{% static 'js/jquery.form.min.js' %}"></script>
<script>
    function updateProfilePhoto(responseText, statusText, xhr, $form){
        if(responseText['success'] == true){
            document.getElementById("profile_photo").src = responseText['image'];
        }
    }
    function updateCandidateCV(responseText, statusText, xhr, $form){
        if(responseText['success'] == true){
            $('#cv_updated').fadeIn().delay(500).fadeOut();
            document.getElementById("current_cv").href = responseText['cv'];
        }else{
            console.log(responseText);
        }
    }
    $("#cv_upload_btn").on("click", function() {
        $("#cv_upload").trigger("click");
    });
    $("#photo_upload_btn").on("click", function() {
        $("#photo_upload").trigger("click");
    });
    $("#photo_upload").change(function(){
        $("#photo_upload_form").ajaxSubmit({success:updateProfilePhoto});
    });
    $("#cv_upload").change(function(){
        $("#cv_upload_form").ajaxSubmit({success:updateCandidateCV});
    });
</script>
{% endblock %}
